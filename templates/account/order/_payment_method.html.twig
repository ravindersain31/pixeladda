<div class="card payment-methods mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
        <div>{{ form_label(form.paymentMethod) }}</div>
        <div class="total-amount">
            <b>TOTAL:</b>
            {% if additionalAmount is defined %}
                {% set totalAmount = ((order.totalAmount + order.refundedAmount + additionalAmount) - order.totalReceivedAmount) | number_format(2) %}
            {% else %}
                {% set totalAmount = ((order.totalAmount + order.refundedAmount) - order.totalReceivedAmount) | number_format(2) %}
            {% endif %}
            <span id="checkout-order-total-amount" data-amount="{{ totalAmount }}">
                ${{ totalAmount }}
            </span>
        </div>
    </div>
    <div class="card-body">
        <div class="payment-methods-list" role="tablist">
            {% for choice in form.paymentMethod %}
                <label class="payment-method-choice">
                    {{ form_widget(choice) }}
                </label>
            {% endfor %}
        </div>
        <div class="payment-view" id="payment-view">
            <div class="tab-content">
                {% for choice in form.paymentMethod.vars.choices %}
                    <div class="tab-pane {% if choice.value == form.paymentMethod.vars.data %}active show{% endif %}"
                         id="payment-method-{{ choice.value | lower }}" role="tabpanel"
                         aria-labelledby="payment-method-{{ choice.value | lower }}-tab" tabindex="{{ loop.index }}">
                        {% if choice.value | lower == 'credit_card' %}
                            {% if app.user %}
                                {{ include('checkout/_saved_cards.html.twig', { form: form } ) }}
                            {% else %}
                                <div
                                    id="braintree-dropin"
                                    data-saved-braintree-cards-checkout-target="dropin">
                                </div>
                            {% endif %}
                        {% elseif choice.value | lower == 'stripe' %}
                            {{ include('checkout/_stripe.html.twig') }}
                            {% elseif choice.value | lower == 'amazon_pay' %}
                        {% else %}
                            <div class="payment-message">
                                {{ choice.attr['data-help-message'] }}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
        {{ form_errors(form.paymentMethod) }}
        {{ form_help(form.paymentMethod) }}
        {{ form_widget(form.agreeTerms) }}
        <div id="amazon-pay-button-wrapper" style="display: none;">
          {% if amazonPay.signature %}
            <div class="d-flex justify-content-center ysp-express-payment-methods-wrapper">
            <div id="amazon-pay-blocker"></div>
              <div class="amazon-pay-checkout-choose">
                <div id="AmazonPayButtonChoose" style="display:none; margin-top: 10px; box-shadow: 3px 4px 2px #000000;"></div>
                <input
                type="hidden"
                id="amazon-pay-config-choose"
                data-payload="{{ amazonPay.payload | e('html_attr') }}"
                data-signature="{{ amazonPay.signature | e('html_attr') }}"
                data-merchant-id="{{ ysp.env('AMAZON_PAY_MERCHANT_ID') }}"
                data-public-key-id="{{ ysp.env('AMAZON_PAY_PUBLIC_ID') }}"
                data-algorithm="{{ ysp.env('AMAZON_ALGO_KEY') }}"
                data-amount="{{ order.totalAmount - order.totalReceivedAmount | number_format(2, '.', '') }}"
                data-currency="USD"
                >
              </div>
            </div>
          {% endif %}
        </div>
    </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const agreeCheckbox = document.getElementById("approve_proof_agreeTerms");
    const blocker = document.getElementById("amazon-pay-blocker");

    if (agreeCheckbox) {
        agreeCheckbox.addEventListener("change", function () {
            console.log(agreeCheckbox);
            if (agreeCheckbox.checked) {
                blocker.style.display = "none";
            } else {
                blocker.style.display = "block";
            }
        });
    }
 
    function validateAdrress(){
        let hasEmptyValue = false;
        if ($('#approve_proof_agreeTerms').prop('checked') == false){
            hasEmptyValue = true;
        }
        return hasEmptyValue;
    }

    blocker.addEventListener("click", function (e) {
        const hasAddressEmpty = validateAdrress();
        if(hasAddressEmpty){
            alert("Please enter all fields first");
           blocker.style.display = "block";
            return false;
        }else {
            blocker.style.display = "none";
        }
    });

});
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
      const amazonTabPane = document.getElementById("payment-method-amazon_pay");
      const amazonButtonWrapper = document.getElementById("amazon-pay-button-wrapper");
      const submitButton = document.getElementById("approve_proof_submit");
      function toggleAmazonButton() {
        const isActive = amazonTabPane.classList.contains("active") && amazonTabPane.classList.contains("show");
        amazonButtonWrapper.style.display = isActive ? "block" : "none";
        if (submitButton) {
            if (isActive) {
                submitButton.style.display = "none";
            } else {
                submitButton.style.removeProperty("display");
            }
        }
      }
      toggleAmazonButton();
      const tabTriggers = document.querySelectorAll('[data-bs-toggle="tab"]');
      tabTriggers.forEach(trigger => {
          trigger.addEventListener("shown.bs.tab", toggleAmazonButton);
      });
  });
</script>