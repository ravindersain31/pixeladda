{% extends 'base.html.twig' %}

{% block title %}
	Saved Addresses
{% endblock %}
{% block javascripts %}
	<script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyApxy-puRWe0-tyK_eH-1NjadBfucNNmks&loading=async&libraries=places"></script>
{% endblock %}

{% block body %}
	{{ include('common/common_mobile_bar.html.twig', { commonBarText: 'Order Online Or Call Now', commonBarTele: '+1-877-958-1499'}) }}
	{{ include('customer/common/top_section.html.twig', { section: { name: 'Saved Addresses', active: true }}) }}
	{{ include("customer/common/customer_details.html.twig") }}

	<div class="container customer-details proof-order-container saved-addresses-container" data-controller="saved-addresses">
		<div class="common-account-pages-wrapper page-content">

			<div class="info-description-box">
                <div class="info-description alert text-center mb-4">
                    You may store multiple shipping and billing addresses and set one as the default to use on the checkout page. For questions, please call <a href="tel:+1-877-958-1499">+1-877-958-1499</a>,
                        message us on our <a href="javascript:void(Tawk_API.toggle())">Live Chat</a>, or email <a href="mailto:">{{storeInfo.storeEmail}}</a>
                </div>
            </div>

			<div class="row addresses-listing">
				{% for address in addresses %}
					<div class="col-md-6 col-lg-4 mb-4">
						<div class="card address-card h-100 rounded-4 hover-shadow">
							<div class="card-body align-content-center">
								<div class="d-flex justify-content-between align-items-center mb-3">
									<div class="d-flex align-items-center gap-1">
										<div class="address-icon">
											{% if address.addressTag == 'home' %}
												<i class="fas fa-home text-ysp-purple"></i>
											{% elseif address.addressTag == 'work' %}
												<i class="fas fa-briefcase text-ysp-purple"></i>
											{% elseif address.addressTag == 'business' %}
												<i class="fas fa-building text-ysp-purple"></i>
											{% else %}
												<i class="fa fa-location-arrow text-ysp-purple" aria-hidden="true"></i>
											{% endif %}
										</div>
										<h5 class="card-title m-0">
											{{ (address.addressTag == 'other'
												? address.otherAddressTag
												: address.addressTag
											)|default('Home')|title }}
										</h5>
									</div>
									{% if address.isDefault %}
										<span id="default-badge" class="badge badge-purple-soft text-ysp-purple">DEFAULT</span>
									{% endif %}
								</div>

								<div class="address-details">
									<p class="mb-1 text-truncate" style="max-width: 250px;" title="{{ address.addressLine1 }}">
										<i class="fas fa-map-marker-alt text-ysp-purple"></i>
										{{ address.addressLine1 }}
									</p>
									<p class="mb-1 text-muted">
										{{ address.city }},
										{{ address.state.name|default('') }}
										{{ address.zipcode }}
									</p>
									<p class="mb-1 text-muted">{{ address.country.name|default('') }}</p>
								</div>

								<div class="address-actions d-flex align-items-end {% if address.isDefault %} justify-content-end {% else %} justify-content-between {% endif %}">
									{% if not address.isDefault %}
										<button
											class="btn btn-ysp-outline btn-sm"
											data-action="saved-addresses#setAsDefault"
											data-address-id="{{ address.id }}">
												<span class="spinner-border spinner-border-sm me-2 d-none saveAddressLoader" role="status" aria-hidden="true"></span>
												Set As Default
										</button>
									{% endif %}
									<div>
										<button
											class="btn btn-outline-primary btn-sm"
											data-action="saved-addresses#edit"
											data-address-id="{{ address.id }}">
												<span class="spinner-border spinner-border-sm me-2 d-none saveAddressLoader" role="status" aria-hidden="true"></span>
												<i class="fas fa-edit"></i>
										</button>
	
										<button
											class="btn btn-outline-danger btn-sm"
											data-action="saved-addresses#delete"
											data-address-id="{{ address.id }}">
												<span class="spinner-border spinner-border-sm me-2 d-none saveAddressLoader" role="status" aria-hidden="true"></span>
												<i class="fas fa-trash"></i>
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				{% else %}
					<div class="col-12">
						<div class="text-center py-5">
							<i class="fas fa-map-marker-alt fa-3x text-muted mb-3"></i>
							<h4 class="text-muted">No saved addresses</h4>
							<p class="text-muted">Click "Add New Address" to get started</p>
						</div>
					</div>
				{% endfor %}
			</div>
		</div>
	
		{% component BootstrapModal with { id: 'addressModal', size: 'lg' } %}
			{% block modal_full_content %}
				<div class="modal-header">
					<h5 id="addressModalTitle" class="modal-title">Add New Address</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body"
					{{ stimulus_controller('checkout', { formName: 'save_address' }) }}>
					{% set addressType = constant('App\\Enum\\AddressTypeEnum::SHIPPING').value %}
					
					{{ form_start(form, {
						attr: {
							'data-saved-addresses-target': 'form',
							'data-address-type': addressType
						}
					}) }}
						{% include "customer/address_form.html.twig" with { form: form } %}
					{{ form_end(form) }}
				</div>
			{% endblock %}
		{% endcomponent %}
	</div>

{% endblock %}
