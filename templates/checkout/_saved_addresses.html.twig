<div data-controller="saved-addresses">
	{% set defaultAddress = null %}

	{% for address in savedAddresses %}
		{% if address.isDefault %}
			{% set defaultAddress = address %}
		{% endif %}
	{% endfor %}

	{% if defaultAddress is null and savedAddresses|length > 0 %}
		{% set defaultAddress = savedAddresses|first %}
	{% endif %}

	{% if defaultAddress %}
		<div class="default-address-display mb-4 p-3 card block-box-shadow position-relative" data-saved-addresses-target="addressSection" id="addressSection">
			<button type="button" class="btn-close position-absolute top-0 end-0 m-1" aria-label="Close" data-action="saved-addresses#removeSection"></button>

			<div class="d-flex justify-content-between align-items-center flex-lg-nowrap flex-wrap gap-2">

				<div class="d-flex align-items-center gap-2">
					<i class="fas fa-map-marker-alt text-ysp-purple mr-2 fs-4"></i>

					<div>
						<div class="d-flex align-items-center gap-2">
							<strong class="mr-2" data-saved-addresses-target="typeHolder">
								{{ (defaultAddress.addressTag == 'other'
									? defaultAddress.otherAddressTag
									: defaultAddress.addressTag
								)|default('Home')|title }}
							</strong>

							{% if defaultAddress.isDefault %}
								<span class="badge badge-purple-soft text-ysp-purple" data-saved-addresses-target="badgeHolder">
									DEFAULT
								</span>
							{% else %}
								<span data-saved-addresses-target="badgeHolder"></span>
							{% endif %}
						</div>

						<div class="text-muted" data-saved-addresses-target="locationHolder">
							{{ defaultAddress.addressLine1 }},
							{% if defaultAddress.addressLine2 %}
								{{ defaultAddress.addressLine2 }},
							{% endif %}
							{{ defaultAddress.city }},
							{{ defaultAddress.state.name }}
							{{ defaultAddress.zipcode }},
							{{ defaultAddress.country.name }}
						</div>
					</div>
				</div>

				<button type="button" class="btn btn-ysp-outline mx-3" data-bs-toggle="modal" data-bs-target="#checkoutAddressModal">
					Change Shipping & Billing Address
				</button>
			</div>
		</div>
	{% endif %}

	{% component BootstrapModal with { id: 'checkoutAddressModal' } %}
	{% block modal_full_content %}
		<div class="modal-header border-0 pb-0">
			<h5 class="modal-title">Select Shipping Address</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		</div>

		<div class="modal-body pt-3">
			<form data-saved-addresses-target="form">
				{% for address in savedAddresses %}
					<div class="address-option mb-3" data-action="click->saved-addresses#selectAddress">
						<div class="form-check">
							<input class="form-check-input"
									type="radio"
									name="selectedAddress"
									value="{{ address.id }}"
									{% if defaultAddress and address.id == defaultAddress.id %}checked{% endif %}
									data-address="{{
										{
											'id': address.id,
											'addressTag': address.addressTag,
											'otherAddressTag': address.otherAddressTag,
											'isDefault': address.isDefault,
											'firstName': address.firstName,
											'lastName': address.lastName,
											'addressLine1': address.addressLine1,
											'addressLine2': address.addressLine2,
											'city': address.city,
											'zipcode': address.zipcode,
											'state': address.state.isoCode,
											'stateName': address.state.name,
											'country': address.country.isoCode,
											'countryName': address.country.name,
											'phone': address.phone,
											'email': address.email
										}|json_encode|e('html_attr')
									}}">
							<label class="form-check-label w-100">
								<div class="address-details">
									<strong>
										{{ (address.addressTag == 'other'
											? address.otherAddressTag
											: address.addressTag
										)|default('Home')|title }}
									</strong>
									{% if address.isDefault %}
										<span class="badge badge-purple-soft text-ysp-purple">DEFAULT</span>
									{% endif %}

									<div class="text-muted mt-1">
										{{ address.addressLine1 }}
										{% if address.addressLine2 %},
											{{ address.addressLine2 }}
										{% endif %}
									</div>

									<div class="text-muted">
										{{ address.city }},
										{{ address.state.name }},
										{{ address.zipcode }},
										{{ address.country.name }}
									</div>
								</div>
							</label>
						</div>
					</div>
				{% endfor %}
			</form>
		</div>
		<div class="modal-footer border-0 pt-0">
			<button type="button" class="btn btn-ysp-outline" data-action="saved-addresses#saveChanges">
				<span class="spinner-border spinner-border-sm me-2 d-none saveAddressLoader" role="status"></span>
				Save Changes
			</button>
		</div>
	{% endblock %}
	{% endcomponent %}
</div>
